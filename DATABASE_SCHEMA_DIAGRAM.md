# ğŸ—„ï¸ Database Schema Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         METAGAUGE DATABASE SCHEMA                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       USERS          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email (UNIQUE)       â”‚          â”‚
â”‚ password             â”‚          â”‚
â”‚ name                 â”‚          â”‚
â”‚ tier                 â”‚          â”‚
â”‚ api_key (UNIQUE)     â”‚          â”‚
â”‚ is_active            â”‚          â”‚
â”‚ email_verified       â”‚          â”‚
â”‚ analysis_count       â”‚          â”‚
â”‚ monthly_analysis_cnt â”‚          â”‚
â”‚ last_analysis        â”‚          â”‚
â”‚ monthly_reset_date   â”‚          â”‚
â”‚ created_at           â”‚          â”‚
â”‚ updated_at           â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                        â”‚
         â”‚                        â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                      â”‚
         â–¼                        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER_ONBOARDING     â”‚  â”‚  USER_PREFERENCES    â”‚  â”‚     CONTRACTS        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚  â”‚ id (PK)              â”‚  â”‚ id (PK)              â”‚â—„â”€â”€â”
â”‚ user_id (FK)         â”‚  â”‚ user_id (FK)         â”‚  â”‚ user_id (FK)         â”‚   â”‚
â”‚ completed            â”‚  â”‚ email_notifications  â”‚  â”‚ name                 â”‚   â”‚
â”‚ website              â”‚  â”‚ analysis_notifs      â”‚  â”‚ description          â”‚   â”‚
â”‚ twitter              â”‚  â”‚ default_chain        â”‚  â”‚ target_address       â”‚   â”‚
â”‚ discord              â”‚  â”‚ custom_settings      â”‚  â”‚ target_chain         â”‚   â”‚
â”‚ telegram             â”‚  â”‚ created_at           â”‚  â”‚ target_name          â”‚   â”‚
â”‚ logo                 â”‚  â”‚ updated_at           â”‚  â”‚ target_abi           â”‚   â”‚
â”‚ contract_address     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ tags[]               â”‚   â”‚
â”‚ contract_chain       â”‚                            â”‚ is_active            â”‚   â”‚
â”‚ contract_abi         â”‚                            â”‚ is_default           â”‚   â”‚
â”‚ contract_name        â”‚                            â”‚ last_analyzed        â”‚   â”‚
â”‚ contract_purpose     â”‚                            â”‚ analysis_count       â”‚   â”‚
â”‚ contract_category    â”‚                            â”‚ created_at           â”‚   â”‚
â”‚ contract_start_date  â”‚                            â”‚ updated_at           â”‚   â”‚
â”‚ is_indexed           â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ indexing_progress    â”‚                                     â”‚                 â”‚
â”‚ last_analysis_id     â”‚                                     â”‚                 â”‚
â”‚ last_update          â”‚                                     â”‚                 â”‚
â”‚ current_step         â”‚                                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ continuous_sync      â”‚                                     â”‚                 â”‚
â”‚ has_errors           â”‚                                     â–¼                 â–¼
â”‚ completion_reason    â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ continuous_sync_stop â”‚                            â”‚ CONTRACT_COMPETITORS â”‚  â”‚ CONTRACT_RPC_CONFIG  â”‚
â”‚ created_at           â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ updated_at           â”‚                            â”‚ id (PK)              â”‚  â”‚ id (PK)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚ contract_id (FK)     â”‚  â”‚ contract_id (FK)     â”‚
                                                    â”‚ address              â”‚  â”‚ chain                â”‚
                                                    â”‚ chain                â”‚  â”‚ rpc_urls[]           â”‚
                                                    â”‚ name                 â”‚  â”‚ created_at           â”‚
                                                    â”‚ abi                  â”‚  â”‚ updated_at           â”‚
                                                    â”‚ created_at           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚ CONTRACT_ANALYSIS_   â”‚
                                                    â”‚      PARAMS          â”‚
                                                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                    â”‚ id (PK)              â”‚
                                                    â”‚ contract_id (FK)     â”‚
                                                    â”‚ block_range          â”‚
                                                    â”‚ whale_threshold      â”‚
                                                    â”‚ max_concurrent_req   â”‚
                                                    â”‚ failover_timeout     â”‚
                                                    â”‚ max_retries          â”‚
                                                    â”‚ output_formats[]     â”‚
                                                    â”‚ custom_params        â”‚
                                                    â”‚ created_at           â”‚
                                                    â”‚ updated_at           â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ANALYSES        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚
â”‚ user_id (FK)         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ config_id (FK)       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ analysis_type        â”‚                                   â”‚   â”‚
â”‚ status               â”‚                                   â”‚   â”‚
â”‚ progress             â”‚                                   â”‚   â”‚
â”‚ results (JSONB)      â”‚                                   â”‚   â”‚
â”‚ metadata (JSONB)     â”‚                                   â”‚   â”‚
â”‚ error_message        â”‚                                   â”‚   â”‚
â”‚ has_errors           â”‚                                   â”‚   â”‚
â”‚ logs[]               â”‚                                   â”‚   â”‚
â”‚ completed_at         â”‚                                   â”‚   â”‚
â”‚ created_at           â”‚                                   â”‚   â”‚
â”‚ updated_at           â”‚                                   â”‚   â”‚
â”‚ last_update          â”‚                                   â”‚   â”‚
â”‚ current_step         â”‚                                   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚   â”‚
                                                           â”‚   â”‚
                                                           â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚   CHAT_SESSIONS      â”‚                                   â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚   â”‚
â”‚ id (PK)              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ user_id (FK)         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ title                â”‚
â”‚ contract_address     â”‚
â”‚ contract_chain       â”‚
â”‚ contract_name        â”‚
â”‚ is_active            â”‚
â”‚ message_count        â”‚
â”‚ last_message_at      â”‚
â”‚ created_at           â”‚
â”‚ updated_at           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CHAT_MESSAGES      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚
â”‚ session_id (FK)      â”‚
â”‚ role                 â”‚
â”‚ content              â”‚
â”‚ components (JSONB)   â”‚
â”‚ tokens_used          â”‚
â”‚ model                â”‚
â”‚ processing_time      â”‚
â”‚ created_at           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LEGEND:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
PK  = Primary Key
FK  = Foreign Key
[]  = Array type
JSONB = JSON Binary (flexible schema)
â—„â”€â”€ = Foreign Key Relationship
```

## ğŸ”— Relationships

1. **users** â†’ **user_onboarding** (1:1)
2. **users** â†’ **user_preferences** (1:1)
3. **users** â†’ **contracts** (1:many)
4. **users** â†’ **analyses** (1:many)
5. **users** â†’ **chat_sessions** (1:many)
6. **contracts** â†’ **contract_competitors** (1:many)
7. **contracts** â†’ **contract_rpc_config** (1:many)
8. **contracts** â†’ **contract_analysis_params** (1:1)
9. **contracts** â†’ **analyses** (1:many)
10. **chat_sessions** â†’ **chat_messages** (1:many)

## ğŸ“Š Data Flow

```
User Registration
    â†“
users table created
    â†“
user_preferences created (default settings)
    â†“
User completes onboarding
    â†“
user_onboarding created
    â†“
contracts table created (default contract)
    â†“
contract_rpc_config created
    â†“
contract_analysis_params created
    â†“
Analysis started
    â†“
analyses table created (with progress tracking)
    â†“
Analysis completed
    â†“
analyses.results updated (JSONB)
    â†“
User starts chat
    â†“
chat_sessions created
    â†“
chat_messages created (user + AI responses)
```
